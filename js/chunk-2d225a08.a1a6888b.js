(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d225a08"],{e4cf:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("notify",{ref:"notify"}),n("section",{staticClass:"main"},[n("div",{staticClass:"pledge"},[n("div",{staticClass:"pledge-card"},[n("em",[n("img",{attrs:{src:e.nftImage}})]),n("h6",[e._v("#"+e._s(e.tokenId))])]),n("div",{staticClass:"pledge-cont"},[n("u"),n("u"),n("div",{staticClass:"form"},[n("li",[n("h5",[e._v(e._s(e.$t("选择币种")))]),n("div",{staticClass:"input"},[n("i",{staticClass:"ico ico-alone-bottom"}),n("input",{attrs:{type:"text",readonly:""},domProps:{value:e.selectToken},on:{click:function(t){e.formSelect=!e.formSelect}}}),e.formSelect?n("div",{staticClass:"form-select anime-fade-in"},[n("a",{on:{click:function(t){e.selectToken="X-MGP",e.formSelect=!1,e.updateAmount()}}},[e._v("X-MGP")])]):e._e()])]),n("li",[n("h5",[e._v(" "+e._s(e.$t("余额"))),n("em",[e._v(e._s(e._f("toFixed")(e.tokenInfo[e.selectToken].balance,8))+" "+e._s(e.selectToken))])]),n("div",{staticClass:"center"},[n("input",{attrs:{type:"text"},domProps:{value:e.payAmount},on:{input:e.inputAmount}}),n("a",{staticClass:"btn code",on:{click:function(t){e.payAmount=e.tokenInfo[e.selectToken].balance}}},[e._v(e._s(e.$t("最大")))])])]),n("li",[n("h5",[e._v(" "+e._s(e.$t("价值MGP"))),n("em",[e._v(e._s(e._f("toFixed")(e.mgpAmount,8))+" ")])])]),n("li",[n("h5",[e._v(" "+e._s(e.$t("锁定时长"))),n("em",[e._v(e._s(null==e.nftInfo?"":e.time(e.nftInfo.lockTime))+" ")])])]),n("li",[n("h5",[e._v(" "+e._s(e.$t("收益比例"))),n("em",[e._v(e._s(e._f("toFixed")(null==e.nftInfo?"0":100*e.nftInfo.levelConfig.userRatio,2))+"% ")])])]),n("li",[n("h5",[e._v(" "+e._s(e.$t("预计到期可领取"))),n("em",[e._v(e._s(e._f("toFixed")(e.outAmount,8))+" MGP")])])]),e.tokenInfo[e.selectToken].showApprove?n("li",[n("button",{staticClass:"btn",on:{click:e.submitApprove}},[n("s"),n("s"),e._v(e._s(e.$t("授权")))])]):e._e(),e.tokenInfo[e.selectToken].showApprove?e._e():n("li",[n("button",{staticClass:"btn",on:{click:e.submitJoin}},[n("s"),n("s"),e._v(e._s(e.$t("支付")))])])])])])])],1)},o=[],r=n("3835"),s=n("1da1"),i=n("ade3"),c=(n("96cf"),n("d3b7"),n("25f0"),n("a9e3"),n("99af"),n("b680"),n("b0c0"),n("a15b"),n("3ca3"),n("ddb0"),n("ee7a")),u=n("901e"),l=n.n(u),f=n("ed08"),p=n("c1df"),d=n.n(p),m={name:"Pledge",components:{Notify:c["a"]},watch:Object(i["a"])({},"$store.state.walletAddress",(function(){this.init()})),data:function(){return{nftImage:"",nftId:"",tokenId:"",nftInfo:null,formSelect:!1,selectToken:"X-MGP",payAmount:"",mgpAmount:"",outAmount:"0",tokenInfo:{"X-MGP":{name:"xmgp",showApprove:!0,balance:"0"},"X-MAST":{name:"xmast",showApprove:!0,balance:"0"}}}},methods:{time:function(e){var t=d.a.duration(1e3*e,"ms"),n=parseInt(Number(e/3600/24).toString(),10),a=t.get("hours"),o=t.get("minutes"),r=t.get("seconds");return"".concat(n>0?"".concat(n," ").concat(this.$t("日")):"").concat(a>0?"".concat(a," ").concat(this.$t("时")):"").concat(o>0?"".concat(o," ").concat(this.$t("分")):"").concat(r>0?"".concat(r," ").concat(this.$t("秒")):"")},updateAmount:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(null==e.nftInfo||!Object(f["b"])(e.payAmount)){t.next=14;break}if("X-MAST"!==e.selectToken){t.next=10;break}return t.next=4,e.$api.getReadConnect().tradeApi().buyCalcMGP(new l.a(e.payAmount).multipliedBy(1e18).toFixed(0));case 4:n=t.sent,e.outAmount=new l.a(n.toString()).multipliedBy("0.999").multipliedBy(e.nftInfo.levelConfig.userRatio).div(1e18).toFixed(18,l.a.ROUND_DOWN),e.mgpAmount=new l.a(n.toString()).div(1e18).toFixed(),t.next=12;break;case 10:e.outAmount=new l.a(e.nftInfo.levelConfig.userRatio).multipliedBy(e.payAmount).toFixed(18,l.a.ROUND_DOWN),e.mgpAmount=e.payAmount;case 12:t.next=15;break;case 14:e.outAmount="";case 15:case"end":return t.stop()}}),t)})))()},inputAmount:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.payAmount=e.target.value,n.next=3,t.updateAmount();case 3:case"end":return n.stop()}}),n)})))()},submitJoin:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$loading.show(),t.prev=1,n=e.$api.getConnect(),t.next=6,e.updateAmount();case 6:if(Object(f["b"])(e.outAmount)){t.next=9;break}return e.$toast(e.$t("请输入正确的数")),t.abrupt("return");case 9:return t.next=12,n.tradeApi().join(e.nftInfo.tokenId,n.addressInfo[e.tokenInfo[e.selectToken].name],new l.a(e.payAmount).multipliedBy(1e18).toFixed(0));case 12:return a=t.sent,e.$refs.notify.show(a.getHash()),t.next=16,a.confirm();case 16:return e.$toast(e.$t("质押成功")),t.next=19,e.init();case 19:t.next=25;break;case 21:t.prev=21,t.t0=t["catch"](1),e.$toast(t.t0.message);case 25:return t.prev=25,e.$loading.hide(),t.finish(25);case 28:case"end":return t.stop()}}),t,null,[[1,21,25,28]])})))()},submitApprove:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$loading.show(),t.prev=1,n=e.$api.getConnect(),t.next=5,n.erc20().approve(n.addressInfo.mgpNftOrder,n.addressInfo[e.tokenInfo[e.selectToken].name]);case 5:return a=t.sent,e.$refs.notify.show(a.getHash()),t.next=9,a.confirm();case 9:return e.$toast(e.$t("授权成功")),t.next=12,e.init();case 12:t.next=17;break;case 14:t.prev=14,t.t0=t["catch"](1),e.$toast(t.t0.message);case 17:return t.prev=17,e.$loading.hide(),t.finish(17);case 20:case"end":return t.stop()}}),t,null,[[1,14,17,20]])})))()},init:function(){var e=arguments,t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){var a,o,s,i,c,u,l;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=!(e.length>0&&void 0!==e[0])||e[0],a&&t.$loading.show(),n.prev=2,!t.$store.state.walletConnect){n.next=31;break}return o=t.$api.getConnect(),n.next=7,Promise.all([o.erc20().getBalanceAndApprove(o.addressInfo.mgpNftOrder,o.addressInfo.xmgp,t.$store.state.walletAddress),o.erc20().getBalanceAndApprove(o.addressInfo.mgpNftOrder,o.addressInfo.xmast,t.$store.state.walletAddress)]);case 7:return s=n.sent,i=Object(r["a"])(s,2),c=i[0],u=i[1],n.prev=11,n.next=14,o.tradeApi().nftInfo(t.nftId);case 14:l=n.sent,t.nftInfo=l,t.nftImage=l.url,t.tokenId=l.tokenId,n.next=24;break;case 20:return n.prev=20,n.t0=n["catch"](11),t.$toast(n.t0.message),n.abrupt("return");case 24:t.tokenInfo["X-MGP"].showApprove=c.showApprove,t.tokenInfo["X-MGP"].balance=c.amount,t.tokenInfo["X-MAST"].showApprove=u.showApprove,t.tokenInfo["X-MAST"].balance=u.amount,n.next=34;break;case 31:return n.next=33,t.$api.getReadConnect().tradeApi().nftConfig("");case 33:t.nftConfig=n.sent;case 34:return n.prev=34,a&&t.$loading.hide(),n.finish(34);case 37:case"end":return n.stop()}}),n,null,[[2,,34,37],[11,20]])})))()}},mounted:function(){this.init()},created:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.nftId=e.$route.query.nftId;case 1:case"end":return t.stop()}}),t)})))()}},v=m,h=n("2877"),g=Object(h["a"])(v,a,o,!1,null,"2c5514f4",null);t["default"]=g.exports}}]);